<project name="upload" default="dist" basedir=".">
    <description>
        Ant build file used to upload binaries to openjpa.apache.org/builds/latest. 
    </description>
    <target name="upload">
        <mkdir dir="target/site/tempDocs" />
        <unzip dest="target/site/tempDocs">
            <fileset dir="target/site/downloads">
                <include name="*binary*.zip" />
            </fileset>
            <patternset>
                <include name="**/javadoc/**" />
                <include name="**/manual/**" />
            </patternset>
        </unzip>
        <move todir="target/site/tempDocs/docs">
            <fileset dir="target/site/tempDocs/apache-openjpa-${pom.version}/docs" /> 
        </move>
        <checksum> 
            <fileset dir="target/site/downloads/">
                <include name="*.zip" />
            </fileset>
        </checksum>
        <scp todir="${nightly.user.name}:${nightly.password}@people.apache.org:/www/openjpa.apache.org/builds/${nightly.version}/downloads" trust="true">
            <fileset dir="target/site/downloads" />
        </scp>
        <scp todir="${nightly.user.name}:${nightly.password}@people.apache.org:/www/openjpa.apache.org/builds/${nightly.version}/docs" trust="true">
            <fileset dir="target/site/tempDocs/docs" /> 
        </scp>
        <sshexec host="people.apache.org" username="${nightly.user.name}" password="${nightly.password}" command="chmod -R g+w /www/openjpa.apache.org/builds/${nightly.version}" trust="true" />
        <delete>
            <fileset dir="target/site/tempDocs" />
        </delete>
    </target>
</project>

